(()=>{var e={8188:(e,t,n)=>{"use strict";n(5363),n(71);var s=n(2730),o=n(9592),r=n(3673);function i(e,t,n,s,o,i){const a=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(a)}var a=n(3617),c=n(52),l=n.n(c),u=n(4854),d=n(8825);const h={name:"App",setup(){const e=(0,d.Z)();return{showNotify(t){e.notify({message:t,color:"red"})}}},mounted(){const e=(0,u.h)();e.subscribe("stop_channel",((e,t)=>{this.$store.commit("global/removeChannel",{uuid:t.uuid})})),e.subscribeR(["createRoom","start_channel"],((t,n)=>{let s=this.getRooms;-1===s.findIndex((e=>e.uuid===n.uuid))&&this.$store.commit("global/addRoom",{title:n.title,uuid:n.uuid,public_key:n.public_key,private_key:n.private_key}),e.subscribeChannel(n.uuid,((e,t,n)=>{"message"===t&&this.$store.commit("global/addMessage",{channel_id:e,data:n}),"userlist"===t&&this.$store.commit("global/setUserlist",{channel_id:e,data:n})}))})),e.subscribe("ping",((t,n)=>{e.callMethod("pong",{})})),l().post("/settings",{}).then((t=>{let n=t.data.socket_port;e.setServer("ws://"+window.location.hostname+":"+n+"/").then((()=>{this.tryAuth()}))}))},computed:{...(0,a.Se)("global",["getIsLoggedIn","","getNickname","getKeyData","getRooms"])},methods:{tryAuth(){const e=(0,u.h)();if(localStorage.getItem("key")){const t=JSON.parse(localStorage.getItem("key"));e.connect().then((()=>{e.callMethodAsync("authorize",{nickname:t.nickname,loginKey:t.loginKey,publicKey:t.publicKey}).then((e=>{console.log("res=",e),this.$store.commit("global/setNickname",t.nickname),this.$store.commit("global/setKeyData",t),this.$store.commit("global/setLoggedIn",!0),this.$store.commit("global/setRole",e.data.role)})).catch((e=>{this.showNotify(e.data)}))}))}}}};h.render=i;const p=h;var m=n(3121),b=n(7083),f=n(9582);const g=[{path:"/",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(264)]).then(n.bind(n,3264))}]},{path:"/new",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(576)]).then(n.bind(n,2576))}]},{path:"/login",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(354)]).then(n.bind(n,8354))}]},{path:"/login/:invite",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(354)]).then(n.bind(n,8354))}]},{path:"/logout",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(551)]).then(n.bind(n,551))}]},{path:"/room/:id",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(30)]).then(n.bind(n,8015))}]},{path:"/join/:id",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(264)]).then(n.bind(n,3264))}]},{path:"/users",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(950)]).then(n.bind(n,2216))}]},{path:"/rooms",component:()=>Promise.all([n.e(736),n.e(583)]).then(n.bind(n,1583)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(132)]).then(n.bind(n,1109))}]},{path:"/:catchAll(.*)*",component:()=>Promise.all([n.e(736),n.e(193)]).then(n.bind(n,2193))}],_=g,y=(0,b.BC)((function(){const e=f.r5,t=(0,f.p7)({scrollBehavior:()=>({left:0,top:0}),routes:_,history:e("")});return t}));async function v(e,t){const s="function"===typeof m["default"]?await(0,m["default"])({}):m["default"],{storeKey:r}=await Promise.resolve().then(n.bind(n,3121)),i="function"===typeof y?await y({store:s}):y;s.$router=i;const a=e(p);return a.use(o.Z,t),{app:a,store:s,storeKey:r,router:i}}var w=n(4434);const P={config:{},plugins:{Notify:w.Z}},k="";async function C({app:e,router:t,store:n,storeKey:s},o){let r=!1;const i=e=>{r=!0;const n=Object(e)===e?t.resolve(e).fullPath:e;window.location.href=n},a=window.location.href.replace(window.location.origin,"");for(let l=0;!1===r&&l<o.length;l++)try{await o[l]({app:e,router:t,store:n,ssrContext:null,redirect:i,urlPath:a,publicPath:k})}catch(c){return c&&c.url?void(window.location.href=c.url):void console.error("[Quasar] boot error:",c)}!0!==r&&(e.use(t),e.use(n,s),e.mount("#q-app"))}v(s.ri,P).then((e=>Promise.all([Promise.resolve().then(n.bind(n,5474))]).then((t=>{const n=t.map((e=>e.default)).filter((e=>"function"===typeof e));C(e,n)}))))},4854:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i,h:()=>a});var s=n(5429),o=n.n(s);class r{constructor(){o()(this,"_subscribers",{}),o()(this,"_url",""),o()(this,"_connection",null),o()(this,"_request_id",0),o()(this,"_request_waiters",{}),o()(this,"_chan_susbscriptions",{}),o()(this,"_b_close",!1),o()(this,"_connection_closed",!0)}static getInstance(){return null===this._thisClass&&(console.log("created new"),this._thisClass=new r),this._thisClass}sendData(e){this._request_id++,this._connection.send(JSON.stringify(e))}callMethod(e,t,n=null){this._request_id++,console.log(e,t),this._connection.send(JSON.stringify({method:e,request_id:this._request_id,params:t})),"function"===typeof n&&(this._request_waiters["request_"+this._request_id]=n)}callMethodAsync(e,t){console.log(e,t);const n=this;return new Promise(((s,o)=>{n.callMethod(e,t,(e=>{-1===e.result?o(e):s(e)}))}))}connect(){return new Promise(((e,t)=>{if(!this._connection_closed)return void e();this._connection=new WebSocket(this._url),this._connection.onopen=t=>{this.observe("open",null),this._connection_closed=!1,e()},this._b_close=!1;const n=this;this._connection.onmessage=e=>{console.log(e.data);let t=JSON.parse(e.data);if(this._request_waiters.hasOwnProperty("request_"+t.request_id)){const e=this._request_waiters["request_"+t.request_id];try{e(t)}catch{}delete this._request_waiters["request_"+t.request_id]}"channel"===t.method?this.observerChannel(t.channel_id,t.type,t.data):this.observe(t.method,t.data||t.params)},this._connection.onclose=()=>{this._connection_closed=!0,this._b_close||setTimeout((()=>{n.connect()}),1e3)}}))}resetSubscriptions(){this._subscribers={},this._request_waiters={},this._chan_susbscriptions={}}observerChannel(e,t,n){if(this._chan_susbscriptions.hasOwnProperty("c_"+e)){const s=this._chan_susbscriptions["c_"+e];try{s(e,t,n)}catch{}}}async setServer(e){this._url=e,await this.connect()}isClosed(){return this._connection_closed}subscribe(e,t){this._subscribers.hasOwnProperty(e)||(this._subscribers[e]=[]),this._subscribers[e].push(t),console.log("subscribed to ",e)}subscribeR(e,t){e.forEach((e=>{this._subscribers.hasOwnProperty(e)||(this._subscribers[e]=[]),this._subscribers[e].push(t),console.log("subscribed to ",e)}))}subscribeChannel(e,t){this._chan_susbscriptions.hasOwnProperty("c_"+e)||(this._chan_susbscriptions["c_"+e]=null),this._chan_susbscriptions["c_"+e]=t}init_connection(e){}close(){this._b_close=!0,this._connection.close()}observe(e,t){this._subscribers.hasOwnProperty(e)&&this._subscribers[e].forEach(((n,s)=>{try{n(e,t)}catch(o){console.log(o),this._subscribers.splice(s,1)}}))}}o()(r,"_thisClass",null);const i=r;function a(){return r.getInstance()}},5474:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a,api:()=>i});var s=n(7083),o=n(52),r=n.n(o);const i=r().create({baseURL:"https://api.example.com"}),a=(0,s.xr)((({app:e})=>{e.config.globalProperties.$axios=r(),e.config.globalProperties.$api=i}))},4783:(e,t,n)=>{"use strict";n.d(t,{ZR:()=>r,HF:()=>i,Tn:()=>a,Yp:()=>l,HI:()=>u,pe:()=>d});n(979),n(6105),n(2396);var s=n(4780),o=n(9969);const r=(e,t)=>s.box.before(t,e),i=(e,t)=>s.box.before(e,t),a=e=>(0,o.decodeBase64)(e),c=()=>(0,s.randomBytes)(s.box.nonceLength),l=()=>{const e=s.box.keyPair();return{publicKey:(0,o.encodeBase64)(e.publicKey),secretKey:(0,o.encodeBase64)(e.secretKey)}},u=(e,t)=>{const n=c(),r=(0,o.decodeUTF8)(t),i=s.box.after(r,n,e),a=new Uint8Array(n.length+i.length);a.set(n),a.set(i,n.length);const l=(0,o.encodeBase64)(a);return l},d=(e,t)=>{const n=(0,o.decodeBase64)(t),r=n.slice(0,s.box.nonceLength),i=n.slice(s.box.nonceLength,t.length),a=s.box.open.after(i,r,e);a||console.log("Could not decrypt message");const c=(0,o.encodeUTF8)(a);return c}},3121:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var s={};n.r(s),n.d(s,{getChat:()=>m,getIsLoggedIn:()=>u,getKeyData:()=>d,getMessagesRead:()=>f,getNickname:()=>l,getRole:()=>p,getRooms:()=>h,getwindowText:()=>b});var o={};n.r(o),n.d(o,{addMessage:()=>k,addRoom:()=>w,deleteRoom:()=>C,removeChannel:()=>q,reset:()=>R,setKeyData:()=>_,setLoggedIn:()=>v,setMessagesRead:()=>O,setNickname:()=>y,setRole:()=>T,setUserlist:()=>P,windowText:()=>x});var r={};n.r(r),n.d(r,{setKeyDataAction:()=>S});var i=n(7083),a=n(3617);function c(){return{nickname:"you are not logged in",logged_in:!1,keyData:{},rooms:[],messages:{},messagesRead:{},userlist:{},windowText:"",role:0}}function l(e){return e.nickname}function u(e){return e.logged_in}function d(e){return e.keyData}function h(e){return e.rooms}function p(e){return e.role}function m(e){return e.messages}function b(e){return e.windowText}function f(e){return e.messagesRead}var g=n(4783);function _(e,t){e.keyData=t}function y(e,t){e.nickname=t}function v(e,t){e.logged_in=t}function w(e,t){e.messages["c_"+t.uuid]=[],e.messagesRead["c_"+t.uuid]=0,e.rooms.push(t)}function P(e,t){e.userlist["c_"+t.channel_id]=t.data}function k(e,t){if(e.messages.hasOwnProperty("c_"+t.channel_id)||(e.messages["c_"+t.channel_id]=[]),void 0!==t.data.text){let n=e.userlist["c_"+t.channel_id],s=n.find((e=>e.nickname===t.data.name)),o=e.rooms.find((e=>e.uuid===t.channel_id));if(s){let e=t.data.text[0];t.data.text=(0,g.pe)((0,g.HF)((0,g.Tn)(s.public_key),(0,g.Tn)(o.private_key)),e)}}e.messages["c_"+t.channel_id].push(t.data)}function C(e,t){let n=e.rooms;n.filter((e=>e.uuid!==t.uuid)),e.rooms=n}function x(e,t){e.windowText=t}function O(e,t){e.messagesRead["c_"+t.uuid]=t.count}function q(e,t){let n=e.rooms;e.rooms=n.filter((e=>e.uuid!==t.uuid)),e.userlist["c_"+t.uuid]=void 0,e.messages["c_"+t.uuid]=void 0}function R(e){e.rooms=[],e.messages={},e.messagesRead={},e.userlist={}}function T(e,t){e.role=t}function S(e){}const N={namespaced:!0,getters:s,mutations:o,actions:r,state:c},A=(0,i.h)((function(){const e=(0,a.MT)({modules:{global:N},strict:!1});return e}))},5024:()=>{}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,(()=>{var e=[];n.O=(t,s,o,r)=>{if(!s){var i=1/0;for(u=0;u<e.length;u++){for(var[s,o,r]=e[u],a=!0,c=0;c<s.length;c++)(!1&r||i>=r)&&Object.keys(n.O).every((e=>n.O[e](s[c])))?s.splice(c--,1):(a=!1,r<i&&(i=r));if(a){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[s,o,r]}})(),(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return n.d(t,{a:t}),t}})(),(()=>{n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,s)=>(n.f[s](e,t),t)),[]))})(),(()=>{n.u=e=>"js/"+e+"."+{30:"9fa4a81f",132:"f16ef555",193:"93f152d0",264:"28c3c502",354:"9274afe8",551:"80c652a2",576:"0dc8665f",583:"d6a39c8f",950:"2d674024"}[e]+".js"})(),(()=>{n.miniCssF=e=>"css/"+({143:"app",736:"vendor"}[e]||e)+"."+{30:"b84b70be",143:"70281206",354:"2a32094b",583:"6224b657",736:"a8870a37",950:"4ebcca6a"}[e]+".css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="schat:";n.l=(s,o,r,i)=>{if(e[s])e[s].push(o);else{var a,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==t+r){a=d;break}}a||(c=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+r),a.src=s),e[s]=[o];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var o=e[s];if(delete e[s],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{n.p=""})(),(()=>{var e=(e,t,n,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var r=r=>{if(o.onerror=o.onload=null,"load"===r.type)n();else{var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=i,c.request=a,o.parentNode.removeChild(o),s(c)}};return o.onerror=o.onload=r,o.href=t,document.head.appendChild(o),o},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),s=0;s<n.length;s++){var o=n[s],r=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(r===e||r===t))return o}var i=document.getElementsByTagName("style");for(s=0;s<i.length;s++){o=i[s],r=o.getAttribute("data-href");if(r===e||r===t)return o}},s=s=>new Promise(((o,r)=>{var i=n.miniCssF(s),a=n.p+i;if(t(i,a))return o();e(s,a,o,r)})),o={143:0};n.f.miniCss=(e,t)=>{var n={30:1,354:1,583:1,950:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=s(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))}})(),(()=>{var e={143:0};n.f.j=(t,s)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)s.push(o[2]);else{var r=new Promise(((n,s)=>o=e[t]=[n,s]));s.push(o[2]=r);var i=n.p+n.u(t),a=new Error,c=s=>{if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",a.name="ChunkLoadError",a.type=r,a.request=i,o[1](a)}};n.l(i,c,"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[i,a,c]=s,l=0;if(i.some((t=>0!==e[t]))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(c)var u=c(n)}for(t&&t(s);l<i.length;l++)r=i[l],n.o(e,r)&&e[r]&&e[r][0](),e[i[l]]=0;return n.O(u)},s=self["webpackChunkschat"]=self["webpackChunkschat"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=n.O(void 0,[736],(()=>n(8188)));s=n.O(s)})();